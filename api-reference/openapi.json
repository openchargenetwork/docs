{
  "openapi": "3.1.0",
  "info": {
    "title": "Opencharge API",
    "description": "API specification for the Opencharge protocol - enabling decentralized payment interoperability and verifiable settlement",
    "version": "0.1.0",
    "license": {
      "name": "MIT"
    }
  },
  "servers": [
    {
      "url": "https://api.example.com/opencharge",
      "description": "Example Opencharge endpoint"
    }
  ],
  "paths": {
    "/metadata.json": {
      "get": {
        "operationId": "getMetadata",
        "summary": "Get OCID metadata",
        "description": "Returns the service's metadata including public key, endpoint URL, capabilities, and settlement preferences. This endpoint is hosted at the URL registered in the Router Registry smart contract. Other services fetch this to discover how to interact with your service and verify your signatures.",
        "responses": {
          "200": {
            "description": "OCID metadata document",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OCIDMetadata"
                },
                "example": {
                  "opencharge": "0.1",
                  "name": "MTN Mobile Money Uganda",
                  "description": "Mobile money service for Uganda",
                  "icon": "https://mtn.co.ug/icon.png",
                  "config": {
                    "publicKey": "a34b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f3a4b",
                    "endpoint": "https://api.mtn.co.ug/opencharge",
                    "capabilities": [
                      "payment.receive",
                      "payment.settle"
                    ],
                    "settlement": {
                      "currencies": [
                        "UGX",
                        "USD"
                      ],
                      "accepts": [
                        100,
                        101,
                        102
                      ]
                    }
                  },
                  "signature": "a1b2c3d4e5f6...7f1b",
                  "contact": "integrations@mtn.co.ug"
                }
              }
            }
          }
        }
      }
    },
    "/capabilities": {
      "get": {
        "operationId": "getCapabilities",
        "summary": "Get service capabilities",
        "description": "Authenticated endpoint for partners to discover their specific capabilities and permissions at a gateway / merchant. Unlike the public /metadata.json, this returns the exact capabilities available to the requesting OCID based on service preferences or partnership agreement.",
        "parameters": [
          {
            "$ref": "#/components/parameters/X-OC-ID"
          },
          {
            "$ref": "#/components/parameters/X-OC-Timestamp"
          },
          {
            "$ref": "#/components/parameters/X-OC-Nonce"
          },
          {
            "$ref": "#/components/parameters/X-OC-Signature"
          }
        ],
        "responses": {
          "200": {
            "description": "Service capabilities and settlement preferences for the authenticated OCID",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Capabilities"
                },
                "example": {
                  "ocid": 300,
                  "name": "MTN Mobile Money Uganda",
                  "capabilities": [
                    "payment.receive",
                    "payment.settle"
                  ],
                  "settlement": {
                    "currencies": [
                      "UGX",
                      "USD"
                    ],
                    "accepts": [
                      100,
                      101
                    ]
                  }
                }
              }
            }
          },
          "401": {
            "description": "Authentication failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/payment/create": {
      "post": {
        "operationId": "createPayment",
        "summary": "Create payment",
        "description": "Create a pending payment to an OCID. This API should be used to request a gateway to make a payment if the requestor OCID has no reserve or account with that said gateway. The response will include which settlement providers are allowed to complete the payment. To complete the payment the requestor must effect a transfer to the gateway OCID via one of the accepted settlement providers.",
        "parameters": [
          {
            "$ref": "#/components/parameters/X-OC-ID"
          },
          {
            "$ref": "#/components/parameters/X-OC-Timestamp"
          },
          {
            "$ref": "#/components/parameters/X-OC-Nonce"
          },
          {
            "$ref": "#/components/parameters/X-OC-Signature"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PaymentRequest"
              },
              "example": {
                "to": 500,
                "amount": "10000.00",
                "currency": "UGX",
                "reference": "ORD-2024-001",
                "memo": "Payment for electronics",
                "expiresAt": 1706503600,
                "order": {
                  "id": "ord_abc123",
                  "urls": {
                    "order": [
                      "https://merchant.example/orders/ord_abc123",
                      "https://gateway.example/orders/abc123"
                    ],
                    "completed": "https://merchant.example/orders/ord_abc123/success",
                    "cancelled": "https://merchant.example/orders/ord_abc123/cancelled"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Payment request created, awaiting settlement",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PaymentRequestResponse"
                },
                "example": {
                  "status": "pending_settlement",
                  "txid": "momo_tx_789",
                  "amount": "10000.00",
                  "currency": "UGX",
                  "expiresAt": 1706503600,
                  "settlement": {
                    "accepts": [
                      100,
                      101
                    ]
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "401": {
            "description": "Authentication failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/payment/settle": {
      "post": {
        "operationId": "settlePayment",
        "summary": "Settle a payment",
        "description": "Submit a settlement proof to complete a pending payment at a gateway. To get proof, use Create Transfer API via any of the supported settlement OCIDs. Reference the pending payment txid in the [to] field.",
        "parameters": [
          {
            "$ref": "#/components/parameters/X-OC-ID"
          },
          {
            "$ref": "#/components/parameters/X-OC-Timestamp"
          },
          {
            "$ref": "#/components/parameters/X-OC-Nonce"
          },
          {
            "$ref": "#/components/parameters/X-OC-Signature"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SettleRequest"
              },
              "example": {
                "txid": "momo_tx_789",
                "proof": {
                  "txid": "barclays_tx_456",
                  "issuer": 100,
                  "from": {
                    "ocid": 200,
                    "reference": "paypal_tx_123"
                  },
                  "to": {
                    "ocid": 300,
                    "reference": "momo_tx_789"
                  },
                  "amount": "10000.00",
                  "currency": "UGX",
                  "timestamp": 1706500500,
                  "memo": "Settlement for ORD-2024-001"
                },
                "signature": "a1b2c3d4e5f6..."
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Payment settled successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SettleResponse"
                },
                "example": {
                  "proof": {
                    "txid": "barclays_tx_456",
                    "issuer": 100,
                    "from": {
                      "ocid": 200,
                      "reference": "paypal_tx_123"
                    },
                    "to": {
                      "ocid": 300,
                      "reference": "momo_tx_789"
                    },
                    "amount": "10000.00",
                    "currency": "UGX",
                    "timestamp": 1706500500,
                    "memo": "Settlement for momo_tx_789"
                  },
                  "signature": "d4e5f6..."
                }
              }
            }
          },
          "400": {
            "description": "Invalid proof or settlement rejected",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "description": "Transaction not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "410": {
            "description": "Transaction expired",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/transfer/create": {
      "post": {
        "operationId": "createTransfer",
        "summary": "Create transfer",
        "description": "Request a payment gateway to create a transfer from your OCID to another OCID. Completed Transfers must provide a signed proof attesting the transfer was completed. Implementations should POST the payment proof to the sender or/and recipient's /transfer/webhook endpoint if supported. Only sign completed transfers.",
        "parameters": [
          {
            "$ref": "#/components/parameters/X-OC-ID"
          },
          {
            "$ref": "#/components/parameters/X-OC-Timestamp"
          },
          {
            "$ref": "#/components/parameters/X-OC-Nonce"
          },
          {
            "$ref": "#/components/parameters/X-OC-Signature"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TransferRequest"
              },
              "example": {
                "from": {
                  "reference": "PAYPAL-RESERVES-UG"
                },
                "to": {
                  "ocid": 300,
                  "reference": "MTN-SETTLEMENTS"
                },
                "amount": "10000.00",
                "currency": "UGX",
                "memo": "Settlement for momo_tx_789",
                "order": {
                  "id": "ord_abc123",
                  "urls": {
                    "order": [
                      "https://merchant.example/orders/ord_abc123"
                    ],
                    "completed": "https://merchant.example/orders/ord_abc123/success",
                    "cancelled": "https://merchant.example/orders/ord_abc123/cancelled"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Transfer completed with signed proof",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TransferResponse"
                },
                "example": {
                  "status": "completed",
                  "proof": {
                    "txid": "barclays_tx_456",
                    "issuer": 100,
                    "from": {
                      "ocid": 200,
                      "reference": "paypal_tx_123"
                    },
                    "to": {
                      "ocid": 300,
                      "reference": "momo_tx_789"
                    },
                    "amount": "10000.00",
                    "currency": "UGX",
                    "timestamp": 1706500500,
                    "memo": "Settlement for momo_tx_789"
                  },
                  "signature": "a1b2c3..."
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "402": {
            "description": "Insufficient funds",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/transfer/webhook": {
      "post": {
        "operationId": "transferWebhook",
        "summary": "Instant Transfer Notification (ITN)",
        "description": "Receive signed transfer proofs on this endpoint. When a transfer involving your OCID is completed, a signed proof is POSTED to this endpoint if supported. Implementations should verify the proof signature, validate the issuer is trusted, and take appropriate action (e.g., credit the recipient, complete a pending payment).",
        "parameters": [
          {
            "$ref": "#/components/parameters/X-OC-ID"
          },
          {
            "$ref": "#/components/parameters/X-OC-Timestamp"
          },
          {
            "$ref": "#/components/parameters/X-OC-Nonce"
          },
          {
            "$ref": "#/components/parameters/X-OC-Signature"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TransferWebhookRequest"
              },
              "example": {
                "proof": {
                  "txid": "barclays_tx_456",
                  "issuer": 100,
                  "from": {
                    "ocid": 200,
                    "reference": "paypal_tx_123"
                  },
                  "to": {
                    "ocid": 300,
                    "reference": "momo_tx_789"
                  },
                  "amount": "10000.00",
                  "currency": "UGX",
                  "timestamp": 1706500500,
                  "memo": "Settlement for ORD-2024-001"
                },
                "signature": "a1b2c3d4e5f6..."
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Notification received and processed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TransferWebhookResponse"
                },
                "example": {
                  "status": "accepted",
                  "txid": "barclays_tx_456"
                }
              }
            }
          },
          "400": {
            "description": "Invalid proof or signature",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "401": {
            "description": "Authentication failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/verify/{txid}": {
      "get": {
        "operationId": "verifyTransaction",
        "summary": "Verify a transaction",
        "description": "Optional endpoint for additional verification of a transfer. Returns the transfer details and signature proof if it exists.",
        "parameters": [
          {
            "name": "txid",
            "in": "path",
            "required": true,
            "description": "The transaction ID {txid} to check",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Transaction verified",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/VerifyResponse"
                },
                "example": {
                  "status": "completed",
                  "proof": {
                    "txid": "barclays_tx_456",
                    "issuer": 100,
                    "from": {
                      "ocid": 200,
                      "reference": "paypal_tx_123"
                    },
                    "to": {
                      "ocid": 300,
                      "reference": "momo_tx_789"
                    },
                    "amount": "10000.00",
                    "currency": "UGX",
                    "timestamp": 1706500500,
                    "memo": "Settlement for momo_tx_789"
                  },
                  "signature": "a1b2c3..."
                }
              }
            }
          },
          "404": {
            "description": "Transaction not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/orders/create": {
      "post": {
        "operationId": "createOrder",
        "summary": "Create order (Merchant)",
        "description": "Payment apps call this endpoint to request a signed order from a merchant. The merchant creates the order, signs it, and returns it with status URLs. The payment app can then process payment and notify the merchant via the status URL.",
        "parameters": [
          {
            "$ref": "#/components/parameters/X-OC-ID"
          },
          {
            "$ref": "#/components/parameters/X-OC-Timestamp"
          },
          {
            "$ref": "#/components/parameters/X-OC-Nonce"
          },
          {
            "$ref": "#/components/parameters/X-OC-Signature"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OrderCreateRequest"
              },
              "example": {
                "id": "ord_abc123",
                "ocid": 500,
                "reference": "store-42",
                "amount": "15.00",
                "currency": "USD",
                "items": [
                  {
                    "id": "item_001",
                    "name": "Large Coffee",
                    "quantity": 2,
                    "price": "5.00"
                  },
                  {
                    "id": "item_002",
                    "name": "Croissant",
                    "quantity": 1,
                    "price": "5.00"
                  }
                ],
                "memo": "Table 5",
                "expiresAt": 1706400000
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Signed order returned successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrderCreateMerchantResponse"
                },
                "example": {
                  "order": {
                    "id": "ord_abc123",
                    "ocid": 500,
                    "reference": "store-42",
                    "amount": "15.00",
                    "currency": "USD",
                    "items": [
                      {
                        "id": "item_001",
                        "name": "Large Coffee",
                        "quantity": 2,
                        "price": "5.00"
                      },
                      {
                        "id": "item_002",
                        "name": "Croissant",
                        "quantity": 1,
                        "price": "5.00"
                      }
                    ],
                    "memo": "Table 5",
                    "createdAt": 1706313600,
                    "expiresAt": 1706400000,
                    "accepts": [100, 101, 102]
                  },
                  "signature": "a1b2c3d4e5f6...7f1b",
                  "urls": {
                    "order": [
                      "https://merchant.example/orders/ord_abc123"
                    ],
                    "completed": "https://merchant.example/checkout/success",
                    "cancelled": "https://merchant.example/checkout/cancelled"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "401": {
            "description": "Authentication failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/orders/checkout": {
      "post": {
        "operationId": "checkoutOrder",
        "summary": "Checkout order (Merchant Gateway)",
        "description": "Merchants call this endpoint on their merchant gateway to initiate a hosted checkout. The merchant submits their signed order along with callback URLs. The gateway returns a redirect URL where the merchant should send the user to complete payment on the gateway's hosted page.",
        "parameters": [
          {
            "$ref": "#/components/parameters/X-OC-ID"
          },
          {
            "$ref": "#/components/parameters/X-OC-Timestamp"
          },
          {
            "$ref": "#/components/parameters/X-OC-Nonce"
          },
          {
            "$ref": "#/components/parameters/X-OC-Signature"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OrderCheckoutRequest"
              },
              "example": {
                "order": {
                  "id": "ord_xyz789",
                  "ocid": 500,
                  "reference": "checkout-session-123",
                  "amount": "99.99",
                  "currency": "USD",
                  "memo": "Online purchase",
                  "createdAt": 1706313600,
                  "expiresAt": 1706400000,
                  "accepts": [100, 101]
                },
                "signature": "a1b2c3d4e5f6...merchant_sig",
                "urls": {
                  "order": ["https://merchant.example/orders/ord_xyz789"],
                  "completed": "https://merchant.example/checkout/success",
                  "cancelled": "https://merchant.example/checkout/cancelled"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Checkout session created, redirect URL returned",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrderCheckoutResponse"
                },
                "example": {
                  "redirect_url": "https://pay.gateway.example/checkout/session_abc123"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or signature",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "401": {
            "description": "Authentication failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/orders/create/{sessionId}": {
      "post": {
        "operationId": "createOrderPaymentGateway",
        "summary": "Create order (Payment Gateway)",
        "description": "Submit a signed order to a payment gateway's session endpoint. This endpoint is used when a payment gateway displays a QR code for the user to pay. The merchant scans the QR code (which contains this endpoint URL with a sessionId) and posts their signed order. The gateway uses the sessionId to identify the user and process the payment.\n\n**Flow:**\n1. User opens payment gateway app (wallet)\n2. Gateway generates temporary sessionId and displays QR code containing: `{gateway-endpoint}/orders/create/{sessionId}` and the gateway's OCID\n3. Merchant scans QR code\n4. Merchant constructs order, signs it, and POSTs to this endpoint\n5. Gateway invalidates session, retrieves user, processes payment\n6. Merchant polls the returned status URL or listens on transfer/webhook for payment confirmation",
        "parameters": [
          {
            "name": "sessionId",
            "in": "path",
            "required": true,
            "description": "Temporary session ID generated by the payment gateway. This ID is ephemeral and used to identify the user without exposing their user ID.",
            "schema": {
              "type": "string"
            }
          },
          {
            "$ref": "#/components/parameters/X-OC-ID"
          },
          {
            "$ref": "#/components/parameters/X-OC-Timestamp"
          },
          {
            "$ref": "#/components/parameters/X-OC-Nonce"
          },
          {
            "$ref": "#/components/parameters/X-OC-Signature"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OrderCreateGatewayRequest"
              },
              "example": {
                "order": {
                  "id": "ord_abc123",
                  "ocid": 500,
                  "reference": "POS-001",
                  "amount": "25.00",
                  "currency": "USD",
                  "items": [
                    {
                      "id": "item_001",
                      "name": "Burger Combo",
                      "quantity": 1,
                      "price": "25.00"
                    }
                  ],
                  "memo": "Order #42",
                  "createdAt": 1706313600,
                  "expiresAt": 1706400000,
                  "accepts": [100, 101, 102]
                },
                "signature": "a1b2c3d4e5f6...merchant_sig",
                "urls": {
                  "order": [
                    "https://merchant.example/orders/ord_abc123"
                  ],
                  "completed": "https://merchant.example/checkout/success",
                  "cancelled": "https://merchant.example/checkout/cancelled"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Order received and payment is being processed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrderCreatePaymentGatewayResponse"
                },
                "example": {
                  "urls": {
                    "status": "https://gateway.example/orders/ord_abc123/status"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or signature",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "description": "Session not found or expired",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "410": {
            "description": "Session already used",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/inventory": {
      "get": {
        "operationId": "getInventory",
        "summary": "Get inventory",
        "description": "Returns the merchant's full inventory. Designed for small inventories such as vending machines or kiosks. Payment apps call this endpoint to display available items before creating an order.",
        "responses": {
          "200": {
            "description": "Inventory retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/InventoryResponse"
                },
                "example": {
                  "ocid": 500,
                  "currency": "USD",
                  "items": [
                    {
                      "id": "item_001",
                      "name": "Coca-Cola",
                      "description": "330ml can",
                      "price": "2.50",
                      "quantity": 15,
                      "min_qty": 1,
                      "max_qty": 5,
                      "images": ["https://merchant.example/images/coke.jpg"],
                      "url": "https://merchant.example/products/coca-cola"
                    },
                    {
                      "id": "item_002",
                      "name": "Snickers Bar",
                      "description": "52g chocolate bar",
                      "price": "1.75",
                      "quantity": 8,
                      "min_qty": 1,
                      "max_qty": 10,
                      "images": ["https://merchant.example/images/snickers.jpg"],
                      "url": "https://merchant.example/products/snickers"
                    }
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/orders/{orderId}/status": {
      "get": {
        "operationId": "getOrderStatus",
        "summary": "Get order status",
        "description": "Get the current payment status of an order. Implemented by merchants to allow payment apps and customers to check if an order has been paid.",
        "parameters": [
          {
            "name": "orderId",
            "in": "path",
            "required": true,
            "description": "The order ID from the signed order object",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Order status retrieved",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OrderStatusResponse"
                },
                "example": {
                  "orderId": "ord_abc123",
                  "status": "paid",
                  "paidAt": 1706313900,
                  "txid": "tx_xyz789"
                }
              }
            }
          },
          "404": {
            "description": "Order not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "parameters": {
      "X-OC-ID": {
        "name": "X-OC-ID",
        "in": "header",
        "required": true,
        "description": "Sender's OCID (Opencharge ID)",
        "schema": {
          "type": "string"
        },
        "example": "200"
      },
      "X-OC-Timestamp": {
        "name": "X-OC-Timestamp",
        "in": "header",
        "required": true,
        "description": "Unix timestamp in seconds",
        "schema": {
          "type": "string"
        },
        "example": "1706500000"
      },
      "X-OC-Nonce": {
        "name": "X-OC-Nonce",
        "in": "header",
        "required": true,
        "description": "Unique request identifier for replay protection",
        "schema": {
          "type": "string"
        },
        "example": "req_abc123"
      },
      "X-OC-Signature": {
        "name": "X-OC-Signature",
        "in": "header",
        "required": true,
        "description": "secp256k1 ECDSA signature of the canonical request",
        "schema": {
          "type": "string"
        },
        "example": "a1b2c3d4...7f1b"
      }
    },
    "schemas": {
      "OCIDMetadata": {
        "type": "object",
        "required": [
          "opencharge",
          "name",
          "config",
          "signature"
        ],
        "description": "Metadata document hosted at the URL registered in the Router Registry. Contains everything other services need to interact with your OCID.",
        "properties": {
          "opencharge": {
            "type": "string",
            "description": "Protocol version",
            "example": "0.1"
          },
          "name": {
            "type": "string",
            "description": "Human-readable service name",
            "example": "MTN Mobile Money Uganda"
          },
          "description": {
            "type": "string",
            "description": "Service description"
          },
          "icon": {
            "type": "string",
            "format": "uri",
            "description": "URL to service logo/icon"
          },
          "config": {
            "$ref": "#/components/schemas/OCIDConfig"
          },
          "signature": {
            "type": "string",
            "description": "secp256k1 signature of the canonicalized config JSON. Proves the config was set by the key holder."
          },
          "contact": {
            "type": "string",
            "description": "Integration support contact (email or URL)"
          }
        }
      },
      "OCIDConfig": {
        "type": "object",
        "required": [
          "publicKey",
          "endpoint",
          "capabilities"
        ],
        "description": "Payment-critical configuration that is signed by the OCID owner. Changes to this object require a new signature.",
        "properties": {
          "publicKey": {
            "type": "string",
            "pattern": "^[a-fA-F0-9]{128}$",
            "description": "secp256k1 public key (128 hex chars, uncompressed format without 04 prefix)"
          },
          "endpoint": {
            "type": "string",
            "format": "uri",
            "description": "Base URL for Opencharge API endpoints"
          },
          "capabilities": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [
                "payment.create",
                "payment.settle",
                "payment.receive",
                "transfer.create",
                "transfer.webhook",
                "orders.create",
                "orders.status",
                "inventory.get",
                "verify.txid"
              ]
            },
            "description": "List of supported operations"
          },
          "settlement": {
            "type": "object",
            "description": "Settlement configuration (required if service accepts settlement)",
            "properties": {
              "currencies": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Supported ISO 4217 currency codes"
              },
              "accepts": {
                "type": "array",
                "items": {
                  "type": "integer"
                },
                "description": "OCIDs accepted for settlement proofs"
              }
            }
          }
        }
      },
      "Capabilities": {
        "type": "object",
        "required": [
          "ocid",
          "name",
          "capabilities"
        ],
        "properties": {
          "ocid": {
            "type": "integer",
            "description": "The service's Opencharge ID"
          },
          "name": {
            "type": "string",
            "description": "Human-readable service name"
          },
          "capabilities": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [
                "payment.create",
                "payment.settle",
                "payment.receive",
                "transfer.create",
                "transfer.webhook",
                "orders.create",
                "orders.status",
                "inventory.get",
                "verify.txid"
              ]
            },
            "description": "List of supported operations"
          },
          "settlement": {
            "$ref": "#/components/schemas/SettlementInfo"
          }
        }
      },
      "SettlementInfo": {
        "type": "object",
        "properties": {
          "currencies": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Supported ISO 4217 currency codes"
          },
          "accepts": {
            "type": "array",
            "items": {
              "type": "integer"
            },
            "description": "OCIDs accepted for settlement"
          }
        }
      },
      "PaymentRequest": {
        "type": "object",
        "required": [
          "to",
          "amount",
          "currency"
        ],
        "properties": {
          "to": {
            "type": "integer",
            "description": "Recipient's OCID (Opencharge ID). The receiving service maps this to their internal account."
          },
          "amount": {
            "type": "string",
            "description": "Payment amount as decimal string"
          },
          "currency": {
            "type": "string",
            "description": "ISO 4217 currency code"
          },
          "reference": {
            "type": "string",
            "description": "External reference ID"
          },
          "memo": {
            "type": "string",
            "description": "Human-readable payment description"
          },
          "expiresAt": {
            "type": "integer",
            "description": "Unix timestamp when the payment request expires"
          },
          "order": {
            "type": "object",
            "description": "Optional order reference for this payment",
            "properties": {
              "id": {
                "type": "string",
                "description": "The order ID from the signed order object"
              },
              "urls": {
                "type": "object",
                "description": "URLs related to the order",
                "properties": {
                  "order": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "format": "uri"
                    },
                    "description": "URLs where the order can be retrieved"
                  },
                  "completed": {
                    "type": "string",
                    "format": "uri",
                    "description": "URL to redirect on successful payment completion"
                  },
                  "cancelled": {
                    "type": "string",
                    "format": "uri",
                    "description": "URL to redirect on payment cancellation"
                  },
                  "payment": {
                    "type": "string",
                    "format": "uri",
                    "description": "URL added by payment gateway for redirect"
                  }
                }
              }
            }
          }
        }
      },
      "PaymentRequestResponse": {
        "type": "object",
        "required": [
          "status",
          "txid",
          "amount",
          "currency"
        ],
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "pending_settlement",
              "completed",
              "expired",
              "failed"
            ],
            "description": "Current status of the payment"
          },
          "txid": {
            "type": "string",
            "description": "Unique transaction ID"
          },
          "amount": {
            "type": "string",
            "description": "Payment amount"
          },
          "currency": {
            "type": "string",
            "description": "Currency code"
          },
          "expiresAt": {
            "type": "integer",
            "description": "Unix timestamp when settlement window closes"
          },
          "settlement": {
            "$ref": "#/components/schemas/SettlementInfo"
          }
        }
      },
      "TransactionProof": {
        "type": "object",
        "required": [
          "txid",
          "issuer",
          "from",
          "to",
          "amount",
          "currency",
          "timestamp"
        ],
        "properties": {
          "txid": {
            "type": "string",
            "description": "Unique transaction ID from issuer"
          },
          "issuer": {
            "type": "integer",
            "description": "OCID of service that executed the transfer"
          },
          "from": {
            "type": "object",
            "required": [
              "ocid"
            ],
            "description": "Sender information",
            "properties": {
              "ocid": {
                "type": "integer",
                "description": "Sender's OCID"
              },
              "reference": {
                "type": "string",
                "description": "Sender's transaction ID for correlating this proof to their original payment"
              }
            }
          },
          "to": {
            "type": "object",
            "required": [
              "ocid"
            ],
            "description": "Recipient information",
            "properties": {
              "ocid": {
                "type": "integer",
                "description": "Recipient's OCID"
              },
              "reference": {
                "type": "string",
                "description": "Recipient's transaction ID for correlating this proof to their pending payment"
              }
            }
          },
          "amount": {
            "type": "string",
            "description": "Amount as decimal string"
          },
          "currency": {
            "type": "string",
            "description": "ISO 4217 currency code"
          },
          "timestamp": {
            "type": "integer",
            "description": "Unix timestamp when transfer completed"
          },
          "memo": {
            "type": "string",
            "description": "Human-readable description"
          }
        }
      },
      "SettleRequest": {
        "type": "object",
        "required": [
          "txid",
          "proof",
          "signature"
        ],
        "properties": {
          "txid": {
            "type": "string",
            "description": "Transaction ID of the pending payment"
          },
          "proof": {
            "$ref": "#/components/schemas/TransactionProof"
          },
          "signature": {
            "type": "string",
            "description": "secp256k1 signature of the canonical proof JSON"
          }
        }
      },
      "SettleResponse": {
        "type": "object",
        "required": [
          "status",
          "txid"
        ],
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "completed"
            ],
            "description": "Settlement status"
          },
          "txid": {
            "type": "string",
            "description": "Transaction ID"
          },
          "completedAt": {
            "type": "integer",
            "description": "Unix timestamp when settlement completed"
          },
          "proof": {
            "$ref": "#/components/schemas/TransactionProof"
          },
          "signature": {
            "type": "string",
            "description": "Signed proof from the recipient service"
          }
        }
      },
      "TransferRequest": {
        "type": "object",
        "required": [
          "from",
          "to",
          "amount",
          "currency"
        ],
        "properties": {
          "from": {
            "type": "object",
            "properties": {
              "ocid": {
                "type": "integer",
                "description": "Sender's OCID"
              },
              "reference": {
                "type": "string",
                "description": "Sender's transaction ID for tracking this payment (e.g., the txid from the original payment.create)"
              }
            }
          },
          "to": {
            "type": "object",
            "required": [
              "ocid"
            ],
            "properties": {
              "ocid": {
                "type": "integer",
                "description": "Recipient's OCID"
              },
              "reference": {
                "type": "string",
                "description": "Recipient's transaction ID for tracking this payment (e.g., txid from their pending payment)"
              }
            }
          },
          "amount": {
            "type": "string",
            "description": "Transfer amount as decimal string"
          },
          "currency": {
            "type": "string",
            "description": "ISO 4217 currency code"
          },
          "memo": {
            "type": "string",
            "description": "Human-readable description"
          },
          "order": {
            "type": "object",
            "description": "Optional order reference for this transfer",
            "properties": {
              "id": {
                "type": "string",
                "description": "The order ID from the signed order object"
              },
              "urls": {
                "type": "object",
                "description": "URLs related to the order",
                "properties": {
                  "order": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "format": "uri"
                    },
                    "description": "URLs where the order can be retrieved"
                  },
                  "completed": {
                    "type": "string",
                    "format": "uri",
                    "description": "URL to redirect on successful payment completion"
                  },
                  "cancelled": {
                    "type": "string",
                    "format": "uri",
                    "description": "URL to redirect on payment cancellation"
                  },
                  "payment": {
                    "type": "string",
                    "format": "uri",
                    "description": "URL added by payment gateway for redirect"
                  }
                }
              }
            }
          }
        }
      },
      "TransferResponse": {
        "type": "object",
        "required": [
          "status",
          "proof",
          "signature"
        ],
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "completed"
            ],
            "description": "Transfer status"
          },
          "proof": {
            "$ref": "#/components/schemas/TransactionProof"
          },
          "signature": {
            "type": "string",
            "description": "secp256k1 signature of the proof"
          }
        }
      },
      "TransferWebhookRequest": {
        "type": "object",
        "required": [
          "proof",
          "signature"
        ],
        "properties": {
          "proof": {
            "$ref": "#/components/schemas/TransactionProof"
          },
          "signature": {
            "type": "string",
            "description": "secp256k1 signature of the proof from the issuer"
          }
        }
      },
      "TransferWebhookResponse": {
        "type": "object",
        "required": [
          "status",
          "txid"
        ],
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "accepted",
              "rejected"
            ],
            "description": "Whether the notification was accepted"
          },
          "txid": {
            "type": "string",
            "description": "The transaction ID from the proof"
          },
          "message": {
            "type": "string",
            "description": "Optional message explaining rejection reason"
          }
        }
      },
      "VerifyResponse": {
        "type": "object",
        "required": [
          "status",
          "proof",
          "signature"
        ],
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "completed",
              "pending",
              "failed"
            ],
            "description": "Transaction status"
          },
          "proof": {
            "$ref": "#/components/schemas/TransactionProof"
          },
          "signature": {
            "type": "string",
            "description": "secp256k1 signature of the proof"
          }
        }
      },
      "Error": {
        "type": "object",
        "required": [
          "error"
        ],
        "properties": {
          "error": {
            "type": "object",
            "required": [
              "code",
              "message"
            ],
            "properties": {
              "code": {
                "type": "string",
                "description": "Error code",
                "enum": [
                  "INVALID_SIGNATURE",
                  "TIMESTAMP_EXPIRED",
                  "NONCE_REUSED",
                  "UNKNOWN_OCID",
                  "METADATA_UNAVAILABLE",
                  "INVALID_PROOF",
                  "PROOF_SIGNATURE_INVALID",
                  "ISSUER_NOT_ACCEPTED",
                  "AMOUNT_MISMATCH",
                  "CURRENCY_MISMATCH",
                  "TXID_NOT_FOUND",
                  "TRANSACTION_EXPIRED",
                  "INSUFFICIENT_FUNDS",
                  "CAPABILITY_NOT_SUPPORTED",
                  "RATE_LIMITED",
                  "ORDER_NOT_FOUND",
                  "ORDER_EXPIRED"
                ]
              },
              "message": {
                "type": "string",
                "description": "Human-readable error message"
              },
              "details": {
                "type": "object",
                "description": "Additional error context"
              }
            }
          }
        }
      },
      "Order": {
        "type": "object",
        "required": [
          "id",
          "ocid",
          "amount",
          "currency",
          "createdAt"
        ],
        "description": "An order object and a signature from a merchant. The entire object is canonicalized and signed by the merchant's private key.",
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique order identifier"
          },
          "ocid": {
            "type": "integer",
            "description": "Merchant's OCID"
          },
          "reference": {
            "type": "string",
            "description": "Merchant's internal reference"
          },
          "amount": {
            "type": "string",
            "description": "Total amount as decimal string"
          },
          "currency": {
            "type": "string",
            "description": "ISO 4217 currency code"
          },
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OrderItem"
            },
            "description": "Line items in the order"
          },
          "memo": {
            "type": "string",
            "description": "Customer-facing note"
          },
          "expiresAt": {
            "type": "integer",
            "description": "Unix timestamp when order expires"
          },
          "createdAt": {
            "type": "integer",
            "description": "Unix timestamp of order creation"
          },
          "accepts": {
            "type": "array",
            "items": {
              "type": "integer"
            },
            "description": "OCIDs accepted for payment settlement. If specified, the merchant will only accept payments via these settlement providers. If empty the accept list from the merchant's OCID metadata is used."
          }
        }
      },
      "OrderItem": {
        "type": "object",
        "required": [
          "id",
          "name",
          "quantity",
          "price"
        ],
        "description": "A line item within an order",
        "properties": {
          "id": {
            "type": "string",
            "description": "Item identifier"
          },
          "name": {
            "type": "string",
            "description": "Display name"
          },
          "quantity": {
            "type": "number",
            "description": "Quantity ordered"
          },
          "price": {
            "type": "string",
            "description": "Unit price as decimal string"
          }
        }
      },
      "OrderCreateRequest": {
        "type": "object",
        "required": [
          "id",
          "ocid",
          "amount",
          "currency"
        ],
        "description": "Request to create and sign an order",
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique order identifier"
          },
          "ocid": {
            "type": "integer",
            "description": "Merchant's OCID"
          },
          "reference": {
            "type": "string",
            "description": "Merchant's internal reference"
          },
          "amount": {
            "type": "string",
            "description": "Total amount as decimal string"
          },
          "currency": {
            "type": "string",
            "description": "ISO 4217 currency code"
          },
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OrderItem"
            },
            "description": "Line items in the order"
          },
          "memo": {
            "type": "string",
            "description": "Customer-facing note"
          },
          "expiresAt": {
            "type": "integer",
            "description": "Unix timestamp when order expires"
          }
        }
      },
      "OrderCreateResponse": {
        "type": "object",
        "required": [
          "order",
          "signature"
        ],
        "description": "Response containing the signed order",
        "properties": {
          "order": {
            "$ref": "#/components/schemas/Order"
          },
          "signature": {
            "type": "string",
            "description": "secp256k1 signature of the canonicalized order JSON"
          },
          "urls": {
            "type": "object",
            "description": "URLs related to the order",
            "properties": {
              "order": {
                "type": "array",
                "items": {
                  "type": "string",
                  "format": "uri"
                },
                "description": "URLs where the order can be retrieved"
              },
              "completed": {
                "type": "string",
                "format": "uri",
                "description": "URL to redirect on successful payment completion"
              },
              "cancelled": {
                "type": "string",
                "format": "uri",
                "description": "URL to redirect on payment cancellation"
              },
              "payment": {
                "type": "string",
                "format": "uri",
                "description": "URL added by payment gateway for redirect"
              }
            }
          }
        }
      },
      "OrderStatusResponse": {
        "type": "object",
        "required": [
          "orderId",
          "status"
        ],
        "description": "Current payment status of an order",
        "properties": {
          "orderId": {
            "type": "string",
            "description": "The order ID"
          },
          "status": {
            "type": "string",
            "enum": [
              "pending",
              "paid",
              "expired",
              "cancelled"
            ],
            "description": "Current payment status"
          },
          "paidAt": {
            "type": "integer",
            "description": "Unix timestamp when order was paid"
          },
          "txid": {
            "type": "string",
            "description": "Transaction ID of the payment"
          }
        }
      },
      "OrderCreateGatewayRequest": {
        "type": "object",
        "required": [
          "order",
          "signature",
          "urls"
        ],
        "description": "Request to submit a signed order to a gateway",
        "properties": {
          "order": {
            "$ref": "#/components/schemas/Order"
          },
          "signature": {
            "type": "string",
            "description": "Merchant's secp256k1 signature of the canonicalized order JSON"
          },
          "urls": {
            "type": "object",
            "required": [
              "completed",
              "cancelled"
            ],
            "description": "Callback URLs for order lifecycle",
            "properties": {
              "order": {
                "type": "array",
                "items": {
                  "type": "string",
                  "format": "uri"
                },
                "description": "URLs where the order can be retrieved"
              },
              "completed": {
                "type": "string",
                "format": "uri",
                "description": "URL to redirect user after successful payment"
              },
              "cancelled": {
                "type": "string",
                "format": "uri",
                "description": "URL to redirect user if payment is cancelled"
              }
            }
          }
        }
      },
      "OrderCreateMerchantResponse": {
        "type": "object",
        "required": [
          "order",
          "signature"
        ],
        "description": "Response from merchant containing the signed order",
        "properties": {
          "order": {
            "$ref": "#/components/schemas/Order"
          },
          "signature": {
            "type": "string",
            "description": "Merchant's secp256k1 signature of the canonicalized order JSON"
          },
          "urls": {
            "type": "object",
            "required": [
              "completed",
              "cancelled"
            ],
            "description": "Callback URLs for order lifecycle",
            "properties": {
              "order": {
                "type": "array",
                "items": {
                  "type": "string",
                  "format": "uri"
                },
                "description": "URLs where the order can be retrieved"
              },
              "completed": {
                "type": "string",
                "format": "uri",
                "description": "URL to redirect user after successful payment"
              },
              "cancelled": {
                "type": "string",
                "format": "uri",
                "description": "URL to redirect user if payment is cancelled"
              }
            }
          }
        }
      },
      "OrderCreatePaymentGatewayResponse": {
        "type": "object",
        "required": [
          "urls"
        ],
        "description": "Response from payment gateway after receiving a signed order",
        "properties": {
          "urls": {
            "type": "object",
            "required": [
              "status"
            ],
            "description": "URLs for order lifecycle",
            "properties": {
              "status": {
                "type": "string",
                "format": "uri",
                "description": "URL to poll for order payment status"
              }
            }
          }
        }
      },
      "OrderCheckoutRequest": {
        "type": "object",
        "required": [
          "order",
          "signature",
          "urls"
        ],
        "description": "Request to initiate a hosted checkout on a merchant gateway",
        "properties": {
          "order": {
            "$ref": "#/components/schemas/Order"
          },
          "signature": {
            "type": "string",
            "description": "Merchant's secp256k1 signature of the canonicalized order JSON"
          },
          "urls": {
            "type": "object",
            "required": [
              "completed",
              "cancelled"
            ],
            "description": "Callback URLs for order lifecycle",
            "properties": {
              "order": {
                "type": "array",
                "items": {
                  "type": "string",
                  "format": "uri"
                },
                "description": "URLs where the order can be retrieved"
              },
              "completed": {
                "type": "string",
                "format": "uri",
                "description": "URL to redirect user after successful payment"
              },
              "cancelled": {
                "type": "string",
                "format": "uri",
                "description": "URL to redirect user if payment is cancelled"
              }
            }
          }
        }
      },
      "OrderCheckoutResponse": {
        "type": "object",
        "required": [
          "redirect_url"
        ],
        "description": "Response from merchant gateway with redirect URL for hosted checkout",
        "properties": {
          "redirect_url": {
            "type": "string",
            "format": "uri",
            "description": "URL to redirect the user to complete payment on the gateway's hosted page"
          }
        }
      },
      "InventoryResponse": {
        "type": "object",
        "required": [
          "ocid",
          "items"
        ],
        "description": "Merchant's full inventory listing",
        "properties": {
          "ocid": {
            "type": "integer",
            "description": "Merchant's OCID"
          },
          "currency": {
            "type": "string",
            "description": "Default ISO 4217 currency code for item prices"
          },
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/InventoryItem"
            },
            "description": "Available inventory items"
          }
        }
      },
      "InventoryItem": {
        "type": "object",
        "required": [
          "id",
          "name",
          "price"
        ],
        "description": "An item available for purchase",
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique item identifier"
          },
          "name": {
            "type": "string",
            "description": "Display name"
          },
          "description": {
            "type": "string",
            "description": "Item description"
          },
          "price": {
            "type": "string",
            "description": "Unit price as decimal string"
          },
          "currency": {
            "type": "string",
            "description": "ISO 4217 currency code (overrides response-level currency)"
          },
          "quantity": {
            "type": "integer",
            "description": "Available stock quantity"
          },
          "min_qty": {
            "type": "integer",
            "description": "Minimum order quantity",
            "default": 1
          },
          "max_qty": {
            "type": "integer",
            "description": "Maximum order quantity"
          },
          "images": {
            "type": "array",
            "items": {
              "type": "string",
              "format": "uri"
            },
            "description": "URLs to item images"
          },
          "url": {
            "type": "string",
            "format": "uri",
            "description": "URL to item details page"
          }
        }
      }
    }
  }
}